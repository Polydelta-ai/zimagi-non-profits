<p align="center">
  <img width="460" height="150" src="assets/zimagi-logo.png">
</p>
<hr/>

<h1 align="center">Non Profit Data Module</h1>
<br/>

## Dependencies
<hr/>
<br/>
This Zimagi module **requires and builds on** the following modules:

<br/>

 * [**Organization Data Module**](https://github.com/Polydelta-ai/zimagi-organizations)

<br/>

## Overview
<hr/>
<br/>

This module provides non-profit models that have general location, informational, and categorization data sourced and imported from the NCCS Data Archive.

<br/>

## Components
<hr/>
<br/>

### Roles
<br/>

| _Name_ | _Description_ |
| ---- | ----------- |
| **non-profit-admin** | _Administrative privileges over non-profit related data_ |
<br/>

### Data Models
<br/>

| _Name_ | _Description_ |
| ---- | ----------- |
| **non_profit** | _Data model that extends organization with non-profit informational fields_ |
<br/>

### Plugin Providers
<br/>

| _Name_ | _Type_ | _Description_ |
| ---- | ---- | ----------- |
| **nccs_category_label** | **formatter** | _Translates an integer code into an NCCS category label_ |
| **nccs_class_label** | **formatter** | _Translates an integer code into an NCCS class label_ |
| **nccs_major_group_label** | **formatter** | _Translates an integer code into an NCCS major group label_ |
| **nccs_sub_group_label** | **formatter** | _Translates an integer code into an NCCS sub group label_ |
| **nccs_purpose_label** | **formatter** | _Translates an integer code into an NCCS purpose label_ |
| **nccs_public_private_label** | **formatter** | _Translates an integer code into an NCCS public / private label_ |
<br/>

### Importers and Calculations
<br/>

| _Name_ | _Type_ | _Description_ |
| ---- | ---- | ----------- |
| **nccs_bmf_2020** | **import** | _Imports IRS Business Master File (BMF) NCCS Archive data for non-profits into internal data models_ |
<br/>

### Orchestration Profiles
<br/>

| _Name_ | _Description_ |
| ---- | ----------- |
| **build** | _Builds data centric Zimagi specifications_ |
<br/>

## How to Use
<hr/>
<br/>

_From the Linux command line interface:_

```bash
# Install the Zimagi application and remote client

pip install zimagi

# Initialize Zimagi platform and make any configuration updates

zimagi env get
#
# The first time executed the zimagi command will provide a link
# to the autogenerated configuration file for the user.  Make any
# changes to this file and run the zimagi command again to continue
# initializing the platform
#

# Install this module into the Zimagi platform

zimagi module add \
    https://github.com/Polydelta-ai/zimagi-non-profits.git \
    reference=main

# Import data
zimagi import --tags=non_profit

# Work with the Zimagi non-profit related data models
# (also available through the Command API)

zimagi non_profit list --help
zimagi non_profit get --help
zimagi non_profit save --help
zimagi non_profit remove --help
zimagi non_profit clear --help

# Access non profit related data through the Data API

# List or search non-profits
curl https://localhost:5323/non_profit
# Get JSON list of specific fields for searchable non-profits
curl https://localhost:5323/non_profit/json
# Get a CSV export of specific fields for searchable non-profits
curl https://localhost:5323/non_profit/csv
# Get a total count of searchable non-profits with field name (non NULL)
curl https://localhost:5323/non_profit/count/{field_name}
# Get a list of unique field values for searchable non-profits (non NULL)
curl https://localhost:5323/non_profit/values/{field_name}
```

_From a Python script:_

```bash
# First ensure zimagi is added to environment or requirements.txt
zimagi>=0.8.0
```

```python
# Import the zimagi package
import zimagi

# Create a message handler for streaming Command API messages
# (if you need or want)
def message_callback(message):
    message.display()

# Create API gateway (using default/development settings)
api = zimagi.Client(
    user = "admin",
    token = "uy5c8xiahf93j2pl8s00e6nb32h87dn3",
    encryption_key = "RFJwNYpqA4zihE8jVkivppZfGVDPnzcq",
    host = "localhost",
    command_port = 5123,
    data_port = 5323,
    message_callback = message_callback
)

# Add Zimagi module

api.extend('https://github.com/Polydelta-ai/zimagi-non-profits.git', 'main',
    provider = 'git'
)

# Execute any Zimagi command
#
# Can reference commands using:
#
# * space separated strings "user list" (CLI format)
# * slash separated strings "user/list" (API format)
# * dot separated strings   "user.list"
#
response = api.execute('non_profit.list')
#
# OR
#
response = api.non_profit__list() # __ converted to /

#
# Association SDK interface
#

# Import associations
api.run_imports(tags = ['non_profit'])

# Save or update non-profit related information
api.save('non_profit', None, # key is autogenerated
    name = "Super Non-Profit",
    city = "Washington",
    state = "DC",
    zipcode = 20024
)

# List and search access non-profits (hyperlinked related objects)
results = api.list('non_profit', name__icontains = "social")

# Return field collections in various formats
json_results = api.json('non_profit', fields = ['name', 'city', 'state'])
df = api.dataframe('non_profit', fields = ['name', 'zipcode'])

# Access non-profit data
data = api.get('non_profit', "{key}")

# Get non-profit field information
results = api.values('non_profit', 'name')
count = api.count('non_profit', 'name')

# Remove non-profits
api.remove('non_profit', "{key}")
api.clear('non_profit', category = 'Health')
```